---
title: "TidyTuesday Challenge 2019/17: Anime Data"
author: "CÃ©dric"
date: 2019-04-23
image: "img/banner/milkyway_RichardStrozynski.jpg"
tags: ["DataViz", "Rstats", "ggplot2", "tidyverse", "TidyTuesday"]
description: "My first participation in the #TidyTuesday challenge exploring data listed on MyAnimeList.net."
output:
  blogdown::html_page:
    toc: true
---


<div id="TOC">
<ul>
<li><a href="#preparation">Preparation</a></li>
<li><a href="#data">Data</a></li>
<li><a href="#plots">Plots</a></li>
<li><a href="#session-info">Session Info</a></li>
</ul>
</div>

<div id="preparation" class="section level1">
<h1>Preparation</h1>
<pre class="r"><code>## packages
library(tidyverse)
library(ggrepel)
library(patchwork)
library(ghibli)

## ggplot theme updates
source(&quot;./tidytuesday/tidy_grey.R&quot;)</code></pre>
</div>
<div id="data" class="section level1">
<h1>Data</h1>
<pre class="r"><code>df_ghibli &lt;- readr::read_csv(&quot;https://raw.githubusercontent.com/rfordatascience/tidytuesday/master/data/2019/2019-04-23/tidy_anime.csv&quot;) %&gt;% 
  filter(studio == &quot;Studio Ghibli&quot;, type == &quot;Movie&quot;) %&gt;% 
  dplyr::select(animeID, title_english, title_japanese, genre, score, scored_by, members)</code></pre>
<pre><code>## Parsed with column specification:
## cols(
##   .default = col_character(),
##   animeID = col_integer(),
##   episodes = col_integer(),
##   airing = col_logical(),
##   start_date = col_date(format = &quot;&quot;),
##   end_date = col_date(format = &quot;&quot;),
##   score = col_double(),
##   scored_by = col_integer(),
##   rank = col_integer(),
##   popularity = col_integer(),
##   members = col_integer(),
##   favorites = col_integer()
## )</code></pre>
<pre><code>## See spec(...) for full column specifications.</code></pre>
</div>
<div id="plots" class="section level1">
<h1>Plots</h1>
<pre class="r"><code>## plot genres
img_a &lt;- png::readPNG(&quot;./tidytuesday/img/totoro.png&quot;) 
a &lt;- grid::rasterGrob(img_a, interpolate = T) 

ghibli_genres &lt;- df_ghibli %&gt;% 
  group_by(genre) %&gt;% 
  count() %&gt;% 
  filter(n &gt; 5) %&gt;% 
  ungroup() %&gt;% 
  mutate(genre = fct_reorder(genre, n)) %&gt;% 
  ggplot(aes(genre, n)) +
    geom_col(aes(fill = genre)) +
    coord_flip() +
    scale_y_continuous(limits = c(0, 20), expand = c(0.01, 0)) +
    scale_fill_ghibli_d(&quot;MononokeLight&quot;) +
    guides(fill = F) + 
    labs(x = &quot;Most common genres&quot;, y = &quot;Count&quot;,
         title = &quot;Studio Ghibli movies listed on MyAnimeList.net (MAL)&quot;,
         subtitle = &quot;&quot;) +
    annotation_custom(a, xmin = 0.4, xmax = 6.75, ymin = 12, ymax = 23) +
    theme(axis.text.x = element_text(family = &quot;Roboto Mono&quot;))

## plot scores
img_b &lt;- png::readPNG(&quot;./tidytuesday/img/ghibli.png&quot;) 
b &lt;- grid::rasterGrob(img_b, interpolate = T) 

set.seed(1)

df_ghibli_unique &lt;-df_ghibli %&gt;% 
  group_by(animeID) %&gt;% 
  summarize_all(first) %&gt;% 
  mutate(title = glue::glue(&quot;{title_japanese}\n({title_english})&quot;))

ghibli_scores &lt;- df_ghibli_unique %&gt;% 
  ggplot(aes(score, scored_by)) +
    geom_point(aes(size = members), color = &quot;#F4C59D&quot;, alpha = 0.6) +
    geom_text_repel(data = filter(df_ghibli_unique, scored_by &gt; 120000), aes(label = title), size = 1.75, family = &quot;Poppins&quot;, 
                    color = &quot;#F4C59D&quot;, segment.size = 0.3, xlim = c(9.25, 10), box.padding = 0.5, force = 5) +
    scale_x_continuous(limits = c(5, 10)) +
    scale_y_continuous(labels = scales::comma, limits = c(0, 600000)) + 
    scale_size_continuous(name = &quot;Times listed by MAL users:&quot;,
                          breaks = c(1000, 10000, 100000, 250000, 500000), 
                          labels = c(&quot;  1,000&quot;, &quot; 10,000&quot;, &quot;100,000&quot;, &quot;250,000&quot;, &quot;500,000&quot;)) +
    guides(size = guide_legend(override.aes = list(alpha = 1))) +
    labs(x = &quot;MAL score&quot;, y = &quot;Number of ratings&quot;,
         caption = &quot;\nVisualization by @CedScherer  |  Picture credit: Studio Ghibli, Inc &amp; MangoKingoroo&quot;) +
    annotation_custom(b, xmin = 5, xmax = 8, ymin = 400000, ymax = 600000) +
    theme(axis.text = element_text(family = &quot;Roboto Mono&quot;),
          legend.position = c(0.32, 0.4),
          legend.background = element_rect(fill = &quot;transparent&quot;),
          legend.title = element_text(size = 9),
          legend.text = element_text(family = &quot;Roboto Mono&quot;, size = 8))

## full panel
ghibli_genres + ghibli_scores</code></pre>
<p><img src="/post/2019-04-23-tidytuesday_201917_animes_files/figure-html/plots-1.png" width="1344" /></p>
</div>
<div id="session-info" class="section level1">
<h1>Session Info</h1>
<pre><code>## R version 3.5.1 (2018-07-02)
## Platform: x86_64-w64-mingw32/x64 (64-bit)
## Running under: Windows 10 x64 (build 17763)
## 
## Matrix products: default
## 
## locale:
## [1] LC_COLLATE=German_Germany.1252  LC_CTYPE=German_Germany.1252   
## [3] LC_MONETARY=German_Germany.1252 LC_NUMERIC=C                   
## [5] LC_TIME=German_Germany.1252    
## 
## attached base packages:
## [1] stats     graphics  grDevices utils     datasets  methods   base     
## 
## other attached packages:
##  [1] bindrcpp_0.2.2  extrafont_0.17  ghibli_0.2.0    patchwork_0.0.1
##  [5] ggrepel_0.8.0   forcats_0.3.0   stringr_1.3.1   dplyr_0.7.7    
##  [9] purrr_0.2.5     readr_1.1.1     tidyr_0.8.2     tibble_1.4.2   
## [13] ggplot2_3.1.0   tidyverse_1.2.1
## 
## loaded via a namespace (and not attached):
##  [1] tidyselect_0.2.5 xfun_0.6         haven_1.1.2      lattice_0.20-35 
##  [5] colorspace_1.3-2 htmltools_0.3.6  yaml_2.1.19      rlang_0.3.0.1   
##  [9] pillar_1.3.0     glue_1.3.0       withr_2.1.2      modelr_0.1.2    
## [13] readxl_1.1.0     bindr_0.1.1      plyr_1.8.4       munsell_0.5.0   
## [17] blogdown_0.11    gtable_0.2.0     cellranger_1.1.0 rvest_0.3.2     
## [21] evaluate_0.13    labeling_0.3     knitr_1.22       curl_3.2        
## [25] Rttf2pt1_1.3.7   broom_0.5.0      Rcpp_0.12.17     scales_1.0.0    
## [29] backports_1.1.2  jsonlite_1.5     png_0.1-7        hms_0.4.2       
## [33] digest_0.6.15    stringi_1.2.4    bookdown_0.9     grid_3.5.1      
## [37] cli_1.0.0        tools_3.5.1      magrittr_1.5     lazyeval_0.2.1  
## [41] extrafontdb_1.0  crayon_1.3.4     pkgconfig_2.0.1  xml2_1.2.0      
## [45] lubridate_1.7.4  assertthat_0.2.0 rmarkdown_1.12   httr_1.3.1      
## [49] rstudioapi_0.8   R6_2.2.2         nlme_3.1-137     compiler_3.5.1</code></pre>
</div>
